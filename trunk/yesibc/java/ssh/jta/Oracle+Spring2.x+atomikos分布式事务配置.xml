<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN 2.0//EN" "http://www.springframework.org/dtd/spring-beans-2.0.dtd">
<beans default-autowire="byName" default-lazy-init="false">

<bean id="AdapterOraBean" class="com.atomikos.jdbc.SimpleDataSourceBean"
	init-method="init" destroy-method="close">
	<property name="uniqueResourceName">
		<value>oracle1</value>
	</property>
	<property name="xaDataSourceClassName">
		<value>oracle.jdbc.xa.client.OracleXADataSource</value>
	</property>
	<property name="xaDataSourceProperties">
		<value>user=adapter;password=adapter;URL=jdbc:oracle:thin:@172.16.47.37:1521:hiatmpdb</value>
	</property>
	<property name="exclusiveConnectionMode">
		<value>true</value>
	</property>
	<property name="connectionPoolSize">
		<value>10</value>
	</property>
	<property name="validatingQuery">
		<value>SELECT 1</value>
	</property>
</bean>

<bean id="PunishOraBean" class="com.atomikos.jdbc.SimpleDataSourceBean"
	init-method="init" destroy-method="close">
	<property name="uniqueResourceName">
		<value>oracle2</value>
	</property>
	<property name="xaDataSourceClassName">
		<value>oracle.jdbc.xa.client.OracleXADataSource</value>
	</property>
	<property name="xaDataSourceProperties">
		<value>user=NLV_GUEST;password=GUEST;URL=jdbc:oracle:thin:@172.16.47.37:1521:hiatmpdb</value>
	</property>
	<property name="exclusiveConnectionMode">
		<value>true</value>
	</property>
	<property name="connectionPoolSize">
		<value>10</value>
	</property>
	<property name="validatingQuery">
		<value>SELECT 1</value>
	</property>
</bean>

<!--分别配置访问AdapterOraBean、PunishOraBean数据源的Spring JDBC模板-->
<bean id="adapterJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
	<property name="dataSource" ref="AdapterOraBean" />
</bean>
<bean id="punishJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
	<property name="dataSource" ref="PunishOraBean" />
</bean>
	<!-- 定义本地实例 -->
<bean id="atomikosTransactionManager" class="com.atomikos.icatch.jta.UserTransactionManager"
	init-method="init" destroy-method="close">
	<property name="forceShutdown">
		<value>true</value>
	</property>
</bean>
<bean id="atomikosUserTransaction" class="com.atomikos.icatch.jta.UserTransactionImp">
	<property name="transactionTimeout" value="120" />
</bean>
	<!-- JTA事务管理器 -->
<bean id="txManager"
	class="org.springframework.transaction.jta.JtaTransactionManager">
	<property name="transactionManager">
		<ref bean="atomikosTransactionManager" />
	</property>
	<property name="userTransaction">
		<ref bean="atomikosUserTransaction" />
	</property>
</bean>
	<!-- tx事务工厂类 -->
<bean id="atomikosTransactionProxy"
	class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean"
	abstract="true">
	<property name="transactionManager">
		<ref bean="txManager" />
	</property>
	<property name="transactionAttributes">
		<props>
			<prop key="*">PROPAGATION_REQUIRED,-Exception</prop>
		</props>
	</property>
</bean>
<bean id="defaultLobHandler" class="org.springframework.jdbc.support.lob.DefaultLobHandler"
	lazy-init="true" />
	<!--分别配置基于模板AdapterOraBean,PunishOraBean的DAO-->
<bean id="TableTest" class="com.hisense.adapter.util.TableTest">
	<property name="jdbcTemplate" ref="adapterJdbcTemplate" />
</bean>
<bean id="ProcedureTest" class="com.hisense.adapter.util.ProcedureTest">
	<property name="jdbcTemplate" ref="punishJdbcTemplate" />
</bean>
	<!--跨数据库的JTA事务的业务类-->
<bean id="CallableTest" parent="atomikosTransactionProxy">
	<property name="target">
		<bean class="com.hisense.adapter.util.CallableTest">
			<property name="tableTest">
				<ref bean="TableTest" />
			</property>
			<property name="procedureTest">
				<ref bean="ProcedureTest" />
			</property>
		</bean>
	</property>
</bean>
</beans>
