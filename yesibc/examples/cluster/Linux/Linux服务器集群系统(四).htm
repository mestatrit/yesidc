<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0062)https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Linux服务器集群系统(四)</title>
<meta http-equiv="PICS-Label" content="(PICS-1.1 &quot;http://www.icra.org/ratingsv02.html&quot; l gen true r (cz 1 lz 1 nz 1 oz 1 vz 1) &quot;http://www.rsac.org/ratingsv01.html&quot; l gen true r (n 0 s 0 v 0 l 0) &quot;http://www.classify.org/safesurf/&quot; l gen true r (SS~~000 1))">
<link rel="schema.DC" href="http://purl.org/DC/elements/1.0/">
<link rel="SHORTCUT ICON" href="http://www.ibm.com/favicon.ico">
  <meta name="Owner" content="dw@cn.ibm.com">
  <meta name="DC.Language" scheme="rfc1766" content="zh-CN">
  <meta name="IBM.Country" content="CN">
<meta name="Security" content="Public">
<meta name="IBM.SpecialPurpose" content="SP001">
<meta name="IBM.PageAttributes" content="sid=1003">
<meta name="Source" content="v16 Template Generator">
<meta name="Robots" content="index,follow">
<meta name="Abstract" content="本文主要讲述了LVS集群的IP负载均衡软件IPVS在内核中实现的各种连接调度算法。针对请求的服务时间变化很大，给出一个动态反馈负载均衡算法，它结合内核中的加权连接调度算法，根据动态反馈回来的负载信息来调整服务器的权值，来进一步避免服务器间的负载不平衡。">
<meta name="Description" content="本文主要讲述了LVS集群的IP负载均衡软件IPVS在内核中实现的各种连接调度算法。针对请求的服务时间变化很大，给出一个动态反馈负载均衡算法，它结合内核中的加权连接调度算法，根据动态反馈回来的负载信息来调整服务器的权值，来进一步避免服务器间的负载不平衡。">
<meta name="Keywords" content="LVS, 集群, 负载均衡, 负载调度, 章文嵩,linux tutorials, linux training, linux standards, linux code, linux resources, linux programming, open source standards, linux how to,, tttlca">
<meta name="DC.Date" scheme="iso8601" content="2002-05-20">
<meta name="DC.Type" scheme="IBM_ContentClassTaxonomy" content="CT316">
<meta name="DC.Subject" scheme="IBM_SubjectTaxonomy" content="SWGC0">
<meta scheme="IBM_WTMCategory" name="IBM.WTMCategory" content="SOFDCLNXCN">
<meta name="DC.Rights" content="© Copyright IBM Corporation 2002">
<meta name="IBM.Effective" scheme="W3CDTF" content="2002-05-20">
<meta name="title" content="Linux服务器集群系统(四)">

<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<link href="./Linux服务器集群系统(四)_files/all.css" media="all" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/screen.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/screen-uas.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/screen-fonts.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/handheld.css" media="handheld" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/print.css" media="print" rel="stylesheet" title="www" type="text/css">
<!-- dW-specific CSS -->
<link href="./Linux服务器集群系统(四)_files/dw-screen.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/dw-local-site.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">
<link href="./Linux服务器集群系统(四)_files/jquery.cluetip.css" media="screen,projection" rel="stylesheet" title="www" type="text/css">

<script src="./Linux服务器集群系统(四)_files/ibmcommon.js" type="text/javascript">//</script><link rel="search" type="application/opensearchdescription+xml" href="http://www.ibm.com/search/opensearch/description.xml" title="IBM Search">
<script src="./Linux服务器集群系统(四)_files/dynamicnav.js" type="text/javascript">//</script>
<!-- Pull-down script --> 
<script type="text/javascript" src="./Linux服务器集群系统(四)_files/dropdown.js">//</script>
<!-- dW functional JS -->
<script language="JavaScript" src="./Linux服务器集群系统(四)_files/urltactic.js" type="text/javascript"></script>
<!-- Rating_START -->

<script language="JavaScript" type="text/javascript">
  // <![CDATA[

 dwr = {};
  dwr.clickhere = '点击评分';
  dwr.stars = '星';
  dwr.star = '星'; 
  dwr.avgRatingOf = '平均分';
  dwr.youRated = '您的评分是';
  dwr.avgRating = '平均分';
  dwr.basedOnVote = '共 {1} 个评分'; // {1} to be substitue by code
  dwr.basedOnVotes = '共 {1} 个评分';
  dwr.leftParen = '（'; 
  dwr.rightParen = ' ）'; 
  dwr.space = ' '; 
  dwr.yourRating = '您的评分';

// ]]>
</script>


<script language="JavaScript" src="./Linux服务器集群系统(四)_files/artrating.js" type="text/javascript"></script>
<style type="text/css">
.metavalue {
  display: none;
}
</style>
<!-- Rating_END --><!-- RESERVED_HEADER_INCLUDE -->
<script language="javascript" src="./Linux服务器集群系统(四)_files/ajax1.js" type="text/javascript"></script>
<script language="javascript" src="./Linux服务器集群系统(四)_files/search_counter-maverick.js" type="text/javascript"></script>
<script language="javascript" src="./Linux服务器集群系统(四)_files/request_referer_capture-maverick.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
 <!--
 setDefaultQuery('defaultHere');
 //-->
</script>
<script language="JavaScript" type="text/javascript">
 <!--
 function openNewWindow(url,tar,arg){window.open(url,tar,arg);}
 //-->
</script>
  <!-- Include file support -->
  <script language="JavaScript" type="text/javascript">
    (function($) {
    jQuery.extend({
    getInc: function(u,d){
    if(u==null)return;
    jQuery.ajax({
    type: "GET",
    url: u,
    dataType: "text",
    success: function(t) {
    jQuery(d).html(t);
    ibmCommon.initShowHide(jQuery(d).children()[0]);	
    },
    async: true
    });
    }
    });
    })(jQuery);
  </script>
<script id="flashdetect" type="text/javascript" src="./Linux服务器集群系统(四)_files/flash-detect.js" charset="UTF-8"></script><script id="mhMenu" type="text/javascript" src="./Linux服务器集群系统(四)_files/cnzh-utf8.js" charset="UTF-8"></script><script id="dynavEA" type="text/javascript" src="./Linux服务器集群系统(四)_files/Controller" charset="UTF-8"></script><script id="wiBundle" type="text/javascript" src="./Linux服务器集群系统(四)_files/Controller(1)" charset="UTF-8"></script></head>

<body id="ibm-com">
<div id="ibm-top" class="ibm-landing-page">

<!-- MASTHEAD_BEGIN -->
<div class="ibm-access"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#main">跳转到主要内容</a></div><div id="ibm-masthead"><div id="ibm-logo"><a href="http://www.ibm.com/cn/zh/"><img width="110" src="./Linux服务器集群系统(四)_files/ibm-logo.gif" height="50" alt="IBM®"></a></div><ul id="ibm-geo"><li class="ibm-first" id="ibm-country">中国</li><li id="ibm-change-country">[ <a href="http://www.ibm.com/developerworks/cn/country/">选择</a> ]</li></ul><form id="ibm-search-form" action="https://www.ibm.com/developerworks/search/searchResults.jsp" method="get" name="form1"><input type="hidden" name="searchType" value="1"><input type="hidden" name="searchSite" value="dWChina"><input type="hidden" name="pageLang" value="zh"><input type="hidden" name="langEncoding" value="UTF8"><p><span id="ibm-search-scope"><label for="sn"><img src="./Linux服务器集群系统(四)_files/c.gif" width="1" height="1" alt="Search in:"></label><select class="input-local" name="searchScope" id="sn" size="1"><option value="dW" selected="selected">dW 全部内容</option><option value="dW">--------------</option><option value="aixunix">&nbsp;&nbsp;AIX and UNIX</option><option value="dmdd">&nbsp;&nbsp;Info Mgmt</option><option value="lotusdd">&nbsp;&nbsp;Lotus</option><option value="rdd">&nbsp;&nbsp;Rational</option><option value="wsdd">&nbsp;&nbsp;WebSphere</option><option value="dW">--------------</option><option value="javaZ">&nbsp;&nbsp;Java technology</option><option value="linuxZ">&nbsp;&nbsp;Linux</option><option value="opensrcZ">&nbsp;&nbsp;Open source</option><option value="webservZ">&nbsp;&nbsp;SOA &amp; Web services</option><option value="webarchZ">&nbsp;&nbsp;Web dev</option><option value="xmlZ">&nbsp;&nbsp;XML</option><option value="dW">--------------</option><option value="all">IBM 全部内容</option></select></span><label for="q"><img alt="搜索:" height="1" width="1" src="./Linux服务器集群系统(四)_files/c.gif"></label><input type="text" name="query" maxlength="100" id="q"><input type="submit" id="ibm-search" class="ibm-btn-search" name="Search" value="搜索"></p></form><div id="ibm-site-name"><!-- IBM site name container --></div><div id="ibm-universal-nav"><ul><li class="ibm-first" id="ibm-unav-home"><a href="http://www.ibm.com/cn/zh/">首页</a></li><li id="ibm-unav-solutions"><a href="http://www.ibm.com/solutions/cn/zh/" class=" ibm-unav-has-child">解决方案</a><div class="ibm-unav-menu" id="gi-bdd52012"><span class="ibm-unav-menu-ehb" id="gi-bdd52012-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-d12178bb-trigger">按行业分类</a><div class="ibm-unav-menu ibm-place-holder" id="gi-d12178bb"><span class="ibm-unav-menu-ehb" id="gi-d12178bb-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/cn/industry/finance/solution/">金融业</a></li><li><a href="http://www.ibm.com/cn/industry/finance/solution/banking.shtml">银行业</a></li><li><a href="http://www.ibm.com/cn/industry/finance/solution/insurance.shtml">保险业</a></li><li><a href="http://www.ibm.com/smb/cn/industries/retail/index.shtml?ca=masterhead&me=cndotcom">零售业</a></li><li><a href="http://www.ibm.com/smb/cn/industries/manufacture/index.shtml?ca=masterhead&me=cndotcom">制造业</a></li><li><a href="http://www.ibm.com/cn/smb/industries/manu/food_sub.shtml?ca=masterhead&me=cndotcom">日常消费品</a></li><li><a href="http://www.ibm.com/cn/smb/industries/manu/tobacco_sub.shtml?ca=masterhead&me=cndotcom">饮料烟草</a></li><li><a href="http://www.ibm.com/cn/industry/distribution/solution/">流通业</a></li><li><a href="http://www.ibm.com/cn/industry/industrial/solution/solu_commu.shtml">电子行业</a></li><li><a href="http://www.ibm.com/cn/industry/telecom/solution/">电信业</a></li><li><a href="http://www.ibm.com/cn/smb/industries/media/index.shtml?ca=masterhead&me=cndotcom">媒体与娱乐业</a></li><li><a href="http://www.ibm.com/cn/industry/distribution/solution/transport.shtml">交通运输业</a></li><li><a href="http://www.ibm.com/cn/industry/industrial/solution/solu_aero.shtml">航空航天造船业</a></li><li><a href="http://www.ibm.com/cn/industry/industrial/solution/solu_auto.shtml">汽车制造业</a></li><li><a href="http://www.ibm.com/cn/industry/industrial/solution/solu_petro.shtml">石油石化业</a></li><li><a href="http://www.ibm.com/cn/public/offertogov/h/">政府与公众事业</a></li><li><a href="http://www.ibm.com/cn/industry/education/solution/">教育</a></li><li><a href="http://www.ibm.com/cn/public/healthcare/solutions/">医疗与生命科学</a></li></ul></div></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-c19eec2c-trigger">按业务需求分类</a><div class="ibm-unav-menu ibm-place-holder" id="gi-c19eec2c"><span class="ibm-unav-menu-ehb" id="gi-c19eec2c-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/smb/cn/business/infrastructure/index.shtml?ca=masterhead&me=cndotcom">IT 基础架构解决方案</a></li><li><a href="http://www.ibm.com/cn/smb/solutions/bi/index.shtml?ca=masterhead&me=cndotcom">商务智能（BI）</a></li><li><a href="http://www.ibm.com/cn/express/business/scm/index.shtml?ca=masterhead&me=cndotcom">供应链管理（SCM）</a></li><li><a href="http://www.ibm.com/cn/express/business/erp/index.shtml?ca=masterhead&me=cndotcom">企业资源规划（ERP）</a></li><li><a href="http://www.ibm.com/cn/smb/solutions/crm/index.shtml?ca=masterhead&me=cndotcom">客户关系管理（CRM）</a></li><li><a href="http://www.ibm.com/cn/smb/solutions/plm/index.shtml?ca=masterhead&me=cndotcom">产品生命周期管理（PLM）</a></li><li><a href="http://www.ibm.com/cn/express/business/oa/index.shtml?ca=masterhead&me=cndotcom">办公自动化(OA)</a></li><li><a href="http://www.ibm.com/cn/express/business/eam/index.shtml?ca=masterhead&me=cndotcom">企业资产管理(EAM)</a></li><li><a href="http://www.ibm.com/software/cn/db2/content-management/industry-solutions/">内容管理</a></li><li><a href="http://www.ibm.com/cn/software/solution/info_conformity.html">信息集成</a></li></ul></div></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-bfc619b5-trigger">按顶级业务合作伙伴分类</a><div class="ibm-unav-menu ibm-place-holder" id="gi-bfc619b5"><span class="ibm-unav-menu-ehb" id="gi-bfc619b5-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/cn/services/hotsale/cisco/index.shtml">IBM 和 Cisco</a></li><li><a href="http://www.ibm.com/cn/services/bcs/alliance/oracle/index.shtml">IBM 与 Oracle</a></li><li><a href="http://www.ibm.com/cn/services/bcs/alliance/sap/index.shtml">IBM 与 SAP</a></li></ul></div></li><li><a href="http://www.ibm.com/cn/services/bcs/">业务咨询</a></li><li><a href="https://www.ibm.com/systems/cn/dihub/index.shtml">IBM 动态架构</a></li><li><a href="https://www.ibm.com/software/cn/smartwork/">IBM智慧运作</a></li><li><a href="https://www.ibm.com/software/cn/nihub/">IBM新锐洞察</a></li><li><a href="https://www.ibm.com/software/cn/spsm/">IBM智慧产品与服务</a></li><li><a href="http://www.ibm.com/software/cn/soa/launch/index.html">面向服务架构 (SOA)</a></li><li><a href="http://www.ibm.com/cn/financing/index.shtml">融资租赁</a></li><li><a href="http://www.ibm.com/smb/cn/business/index.shtml?ca=masterhead&me=cndotcom">面向中型企业及机构的解决方案</a></li><li><a href="http://www.ibm.com/software/cn/solution/">软件行业解决方案</a></li><li><a href="http://www.ibm.com/city/cn/index.shtml?re=masthead">IBM 区域解决方案</a></li><li><a href="http://www.ibm.com/cn/services/bcs/">更多业务解决方案</a></li></ul></div></li><li id="ibm-unav-services"><a href="http://www.ibm.com/technologyservices/cn/zh/" class=" ibm-unav-has-child">服务</a><div class="ibm-unav-menu" id="gi-756e79d0"><span class="ibm-unav-menu-ehb" id="gi-756e79d0-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-764cdefb-trigger">按服务项目分类</a><div class="ibm-unav-menu ibm-place-holder" id="gi-764cdefb"><span class="ibm-unav-menu-ehb" id="gi-764cdefb-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www-31.ibm.com/cn/services/managedservices/">弹性运维服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/bcrs/c1000411">业务连续与灾难恢复服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/imc/c1025977">企业终端用户服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/gn/c1000412">网络服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/igs/c1025997">IT 策略与基础架构服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/its/c1000418">维护与技术支持服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/igs/c1025998">中间件服务</a></li><li><a href="http://www.ibm.com/services/cn/gts/outsourcing.html">外包服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/so/c1000405">企业 IT 安全服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/igs/c1025999">服务器服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/igs/c1026000">数据中心及智能化集成服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/itservice/its/c1000416">数据与存储服务</a></li></ul></div></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-876a3c10-trigger">按业务类型分类</a><div class="ibm-unav-menu ibm-place-holder" id="gi-876a3c10"><span class="ibm-unav-menu-ehb" id="gi-876a3c10-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024566">竞争策略</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024555">营运/委外</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024567">顾客服务及忠诚度</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024553">通路策略实施</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024556">IT 最适化</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024568">全新的工作环境</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024557">灵活可靠的基础建设</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024554">安全和防御</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/businesstopic/igs/a1024569">价值链效益</a></li></ul></div></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-6d35b79d-trigger">按行业分类</a><div class="ibm-unav-menu ibm-place-holder" id="gi-6d35b79d"><span class="ibm-unav-menu-ehb" id="gi-6d35b79d-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024588">跨行业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024537">金融业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024548">银行业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024546">保险业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024547">零售业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024540">消费品</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024545">批发业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024550">电子业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024543">电信业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024538">媒体与娱乐</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024541">旅游和运输业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024542">汽车行业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024552">石油石化行业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024549">政府部门</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024644">能源与公用事业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024544">教育业</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024536">医疗保健</a></li><li><a href="http://www.ibm.com/services/cn/index.wss/industry/igs/a1024539">生命科学</a></li></ul></div></li><li><a href="http://www.ibm.com/training/cn/">培训服务</a></li><li><a href="http://www.ibm.com/cn/software/service/">软件服务</a></li><li><a href="http://www.ibm.com/cn/express/products/igs/?ca=masterhead&me=cndotcom">面向中型企业及机构的服务</a></li><li><a href="http://www.ibm.com/services/cn/index.wss">更多服务</a></li></ul></div></li>
<li id="ibm-unav-products"><a href="http://www.ibm.com/products/cn/zh/" class=" ibm-unav-has-child">产品</a><div class="ibm-unav-menu" id="gi-e7202e3b"><span class="ibm-unav-menu-ehb" id="gi-e7202e3b-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/cn/shop/special.shtml">特惠产品和方案</a></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-9ba5bee-trigger">软件</a><div class="ibm-unav-menu ibm-place-holder" id="gi-9ba5bee"><span class="ibm-unav-menu-ehb" id="gi-9ba5bee-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/cn/software/">所有软件</a></li><li><a href="http://www.ibm.com/software/products/cn/zh">产品目录</a></li><li><a href="http://www.ibm.com/cn/software/db2/">Information Management 信息管理软件</a></li><li><a href="http://www.ibm.com/cn/software/lotus/">Lotus 协作办公软件</a></li><li><a href="http://www.ibm.com/cn/software/rational/">Rational 开发软件</a></li><li><a href="http://www.ibm.com/cn/software/tivoli/">Tivoli 服务管理软件</a></li><li><a href="http://www.ibm.com/cn/software/websphere/">WebSphere 应用系统和整合软件</a></li><li><a href="http://www.ibm.com/cn/software/zseries/">System z 服务器软件</a></li></ul></div></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-1fabe412-trigger">Systems 与服务器</a><div class="ibm-unav-menu ibm-place-holder" id="gi-1fabe412"><span class="ibm-unav-menu-ehb" id="gi-1fabe412-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/systems/cn/">所有 IBM Systems 和服务器</a></li><li><a href="http://www.ibm.com/systems/cn/power/index.shtml">Power Systems</a></li><li><a href="http://www.ibm.com/cn/systems/i/index.shtml">System i （i系列）服务器</a></li><li><a href="http://www.ibm.com/cn/systems/p/">System p （p系列）服务器</a></li><li><a href="http://www.ibm.com/cn/systems/x/">System x （x系列）服务器</a></li><li><a href="http://www.ibm.com/cn/systems/z/">System z （z系列）服务器</a></li><li><a href="http://www.ibm.com/cn/systems/bladecenter/">BladeCenter 刀片服务器</a></li><li><a href="http://www.ibm.com/cn/openpower">OpenPower 服务器</a></li><li><a href="http://www.ibm.com/cn/servers/eserver/xseries/l1350.shtml">群集服务器</a></li><li><a href="http://www.ibm.com/cn/systems/unix/">UNIX 服务器</a></li><li><a href="http://www.ibm.com/cn/servers/eserver/linux/index.shtml">Linux 服务器</a></li><li><a href="http://www.ibm.com/cn/systems/power/index.shtml">POWER 处理器的服务器</a></li><li><a href="http://www.ibm.com/cn/servers/jump_intel.shtml">基于英特尔架构的服务器</a></li></ul></div></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-32a08273-trigger">存储产品</a><div class="ibm-unav-menu ibm-place-holder" id="gi-32a08273"><span class="ibm-unav-menu-ehb" id="gi-32a08273-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/storage/cn/">所有存储产品</a></li><li><a href="http://www.ibm.com/storage/cn/disk/">磁盘存储系统</a></li><li><a href="http://www.ibm.com/storage/cn/tape/">磁带存储系统</a></li><li><a href="http://www.ibm.com/storage/cn/san/">存储区域网络</a></li><li><a href="http://www.ibm.com/storage/cn/nas/">网络连接存储</a></li><li><a href="http://www.ibm.com/storage/cn/software/">存储软件</a></li><li><a href="http://www.ibm.com/storage/cn/product/index.shtml">存储产品排序（A - Z）</a></li></ul></div></li><li><a href="http://www.ibm.com/services/cn/index.wss/offerfamily/igs/c1025846">网络安全</a></li><li><a href="http://www.ibm.com/cn/products/pos/">零售终端</a></li><li><a href="http://www.infoprintsolutionscompany.com/internet/wwsites.nsf/vwWebPublished/mainT1_cn">打印机 (InfoPrint)</a></li><li><a href="http://www.ibm.com/cn/financing/icpe/">IBM 官方认证再制造设备</a></li><li><a href="http://www.ibm.com/cn/servers/eserver/xseries/options.shtml">选件</a></li><li><a href="http://www.ibm.com/cn/promotion/esg/xseries/">中低端产品特惠商城</a></li><li><a href="http://www.ibm.com/cn/express/products/hardware/index.shtml?ca=masterhead&me=cndotcom">面向中型企业及机构的特惠产品</a></li></ul></div></li>
<li id="ibm-unav-support"><a href="http://www.ibm.com/support/cn/zh/" class=" ibm-unav-has-child">支持与下载</a><div class="ibm-unav-menu" id="gi-d57d9229"><span class="ibm-unav-menu-ehb" id="gi-d57d9229-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-fcd32c48-trigger">下载</a><div class="ibm-unav-menu ibm-place-holder" id="gi-fcd32c48"><span class="ibm-unav-menu-ehb" id="gi-fcd32c48-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/cn/support/download/download.shtml">驱动程序和软件下载</a></li></ul></div></li><li><a href="http://www.ibm.com/support/troubleshooting/cn/">故障诊断与排除</a></li><li><a href="http://www.ibm.com/support/advsrch.wss?rs=0&loc=zh_CN">搜索</a></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-daf82f69-trigger">按产品查看</a><div class="ibm-unav-menu ibm-place-holder" id="gi-daf82f69"><span class="ibm-unav-menu-ehb" id="gi-daf82f69-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/cn/support/productsupport/sw_support.shtml">软件产品</a></li><li><a href="http://www.ibm.com/cn/support/productsupport/eserver.shtml">服务器</a></li><li><a href="http://www.ibm.com/cn/support/productsupport/storage_support.shtml">存储产品</a></li><li><a href="http://www.ibm.com/cn/support/productsupport/print_support.shtml">打印机 (InfoPrint)</a></li></ul></div></li><li><a href="http://www.ibm.com/cn/support/mysupport/">个性化支持</a></li><li><a href="http://www.ibm.com/support/publications/cn/index.html">产品资料中心</a></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-de566982-trigger">电子化工具</a><div class="ibm-unav-menu ibm-place-holder" id="gi-de566982"><span class="ibm-unav-menu-ehb" id="gi-de566982-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/support/electronic/uprtransition.wss?category=2&locale=zh_CN">提交服务请求</a></li><li><a href="https://www.ibm.com/support/electronic/portal/!ut/p/kcxml/04_Sj9SPykssy0xPLMnMz0vM0Y_QjzKLt4y3dAXJgFku-pHIIgbxjnABX4_83FT9IKBEpDlQxCVQPyonNT0xuVI_WN9bP0C_IDc0otzb0REAowWZNg!!/delta/base64xml/L2dJQSEvUUt3QS80SVVFLzZfOV85RQ!!?category=4&locale=zh_CN">专项服务</a></li></ul></div></li><li><a href="http://www.ibm.com/cn/support/viewdoc/knowledgebase">技术知识库</a></li><li><a href="http://www.ibm.com/support/operations/cn">在线客户支持</a></li><li><a href="http://www.ibm.com/support/warranties/cn/">保修、许可和维护</a></li></ul></div></li>
<li id="ibm-unav-myibm"><a href="http://www.ibm.com/account/cn/zh/" class=" ibm-unav-has-child">个性化服务</a><div class="ibm-unav-menu" id="gi-ccb5cdb"><span class="ibm-unav-menu-ehb" id="gi-ccb5cdb-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/account/myaccounts/cn/zh/">我的账户</a></li><li class=" ibm-myinterest"><a href="http://www.ibm.com/account/myibm/myinterestView.do?cc=cn&lc=zh" id="gi-ecaf0965-trigger">我的收藏夹</a><div class="ibm-unav-menu ibm-myinterest" id="gi-ecaf0965"><span class="ibm-unav-menu-ehb" id="gi-ecaf0965-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul></ul></div></li><li><a href="http://www.ibm.com/account/myibm/profile.do?cc=cn&lc=zh">我的概要信息</a></li><li class=" ibm-place-holder"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" class=" ibm-unav-menu-has-child" id="gi-8afef389-trigger">客户支持</a><div class="ibm-unav-menu ibm-place-holder" id="gi-8afef389"><span class="ibm-unav-menu-ehb" id="gi-8afef389-ehb"><img alt="" src="./Linux服务器集群系统(四)_files/c(1).gif"></span><a class="ibm-access"></a><ul><li><a href="http://www.ibm.com/support/operations/cn/zh/contracts">合同</a></li><li><a href="http://www.ibm.com/support/operations/cn/zh/orderdelivery">订单与发货</a></li><li><a href="http://www.ibm.com/support/operations/cn/zh/inventory">库存与维护</a></li><li><a href="http://www.ibm.com/support/operations/cn/zh/invoicespayments">发票与付款</a></li><li><a href="http://www.ibm.com/support/operations/cn">更多客户支持</a></li></ul></div></li><li><a href="http://www.ibm.com/account/cn/zh/">了解更多</a></li></ul></div></li>
</ul>
</div>

</div>

<!-- MASTHEAD_END -->

<div id="ibm-pcon">

<!-- CONTENT_BEGIN -->
<div id="ibm-content">

<!-- Navigation_Trail_BEGIN -->
<!-- &nbsp; -->
      <div id="ibm-content-head"><ul id="ibm-navigation-trail"><li class="ibm-first"><a href="http://www.ibm.com/developerworks/cn/">developerWorks 中国</a></li><li><a href="http://www.ibm.com/developerworks/cn/linux/">Linux</a></li><li><a href="http://www.ibm.com/developerworks/cn/views/linux/libraryview.jsp">文档库</a></li></ul></div>
<!-- Navigation_Trail_END -->

<!-- dW_Summary Area_START -->
<div id="dw-summary-article">

<div class="dw-content-head">
<h1>Linux服务器集群系统(四)</h1><p><em>LVS集群的负载调度</em></p>
</div>

<div class="ibm-container-body ibm-two-column">

<div class="ibm-column ibm-first">
<div class="author"><a class="dwauthor" rel="#authortip1" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#author1">章文嵩</a> (<a href="mailto:wensong@linux-vs.org?subject=Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%9B%86%E7%BE%A4%E7%B3%BB%E7%BB%9F(%E5%9B%9B)&cc=wensong@linux-vs.org">wensong@linux-vs.org</a>),  </div><div id="authortip1" class="dwauthor-onload-state ibm-no-print" style="display: none; ">章文嵩博士，开放源码及Linux内核的开发者，著名的Linux集群项目－－LVS(Linux Virtual
Server)的创始人和主要开发人员。他目前工作于国家并行与分布式处理重点实验室，主要从事集群技术、操作系统、对象存储与数据库的研究。他一直在自由软件的开发上花费大量时间，并以此为乐。</div>
<p></p>
  <p><b>简介：</b>&nbsp;本文主要讲述了LVS集群的IP负载均衡软件IPVS在内核中实现的各种连接调度算法。针对请求的服务时间变化很大，给出一个动态反馈负载均衡算法，它结合内核中的加权连接调度算法，根据动态反馈回来的负载信息来调整服务器的权值，来进一步避免服务器间的负载不平衡。</p>

  <!-- <p class="ibm-no-print"><div id="dw-tag-this" class="ibm-no-print"></div><div id="interestShow" class="ibm-no-print"></div></p> -->
<div id="dw-tag-content" class="ibm-no-print"></div><div id="dw-moretags-access" class="ibm-access"></div>
<p class="ibm-no-print"></p><div id="dw-tag-this" class="ibm-no-print"><a class="ibm-external-link" onclick="jQuery.launchTagThisWindow(); return false;" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#">标记本文！</a></div><div id="interestShow" class="ibm-no-print"></div><p></p>
</div>

<div class="ibm-column ibm-second">

<p class="leading"><b>发布日期：</b>&nbsp;2002 年 5 月 20 日
  
<br><b>级别：</b>&nbsp;初级
    

<br><b>访问情况</b>&nbsp;372 次浏览
<br><b>建议:</b>&nbsp;<span id="nCmts">0&nbsp;(<a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#icomments">添加评论</a>)</span>
<!-- Rating_Area_Begin -->
<!-- Ensure that div id is based on input id and ends with -widget -->	
<input id="art-rating" name="ratinga" type="hidden" value="0"></p><div id="art-rating-widget"><a href="javascript:void(0);"><img alt="1 star" title="点击评分 1 星" height="20" src="./Linux服务器集群系统(四)_files/star-off.gif" width="20"></a><a href="javascript:void(0);"><img alt="2 stars" title="点击评分 2 星" height="20" src="./Linux服务器集群系统(四)_files/star-off.gif" width="20"></a><a href="javascript:void(0);"><img alt="3 stars" title="点击评分 3 星" height="20" src="./Linux服务器集群系统(四)_files/star-off.gif" width="20"></a><a href="javascript:void(0);"><img alt="4 stars" title="点击评分 4 星" height="20" src="./Linux服务器集群系统(四)_files/star-off.gif" width="20"></a><a href="javascript:void(0);"><img alt="5 stars" title="点击评分 5 星" height="20" src="./Linux服务器集群系统(四)_files/star-off.gif" width="20"></a><span id="rateTxt">  平均分 （共 0 个评分 ）</span></div>
<script language="JavaScript" type="text/javascript">
// <![CDATA[
 //  widget div id and article id as args
   window.artRating.init('art-rating-widget');
// ]]>
</script>
<!-- Rating_Area_End -->
<p></p>
</div>

</div>
</div>
<!-- dW_Summary_Area_END -->

<!-- CONTENT_BODY -->
<div id="ibm-content-body">

<!-- MAIN_COLUMN_BEGIN -->
<div id="ibm-content-main">

<!-- Related_Searches_Area_And_Overlays_Begin -->

<!-- MAIN_COLUMN_CONTAINER_BEGIN -->
<div class="ibm-container">

<!-- MAIN_COLUMN_CONTENT_BEGIN -->
<p><a name="1"><span class="atitle">前言</span></a></p>
      
      <p>
在上一篇文章中，我们主要讲述了LVS集群中实现的三种IP负载均衡技术，它们主要解决系统的可伸缩性和透明性问题，如何通过负载调度器将请求高效地分发到不同的服务器执行，使得由多台独立计算机组成的集群系统成为一台虚拟服务器；客户端应用程序与集群系统交互时，就像与一台高性能的服务器交互一样。</p>
      <p>本文将主要讲述在负载调度器上的负载调度策略和算法，如何将请求流调度到各台服务器，使得各台服务器尽可能地保持负载均衡。文章主要由两个部分组成。第一部分描述IP负载均衡软件IPVS在内核中所实现的各种连接调度算法；第二部分给出一个动态反馈负载均衡算法（Dynamic-feedback load balancing），它结合内核中的加权连接调度算法，根据动态反馈回来的负载信息来调整服务器的权值，来进一步避免服务器间的负载不平衡。</p>
      <p>在下面描述中，我们称客户的socket和服务器的socket之间的数据通讯为连接，无论它们是使用TCP还是UDP协议。对于UDP数据报文的调度，IPVS调度器也会为之建立调度记录并设置超时值（如5分钟）；在设定的时间内，来自同一地址（IP地址和端口）的UDP数据包会被调度到同一台服务器。</p>
      <div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><p><a name="2"><span class="atitle">内核中的连接调度算法</span></a></p>
      
      <p>IPVS在内核中的负载均衡调度是以连接为粒度的。在HTTP协议（非持久）中，每个对象从WEB服务器上获取都需要建立一个TCP连接，同一用户的不同请求会被调度到不同的服务器上，所以这种细粒度的调度在一定程度上可以避免单个用户访问的突发性引起服务器间的负载不平衡。</p>
      <p>在内核中的连接调度算法上，IPVS已实现了以下八种调度算法：
        </p><ul>
          <li>轮叫调度（Round-Robin Scheduling）</li>
          <li>加权轮叫调度（Weighted Round-Robin Scheduling）</li>
          <li>最小连接调度（Least-Connection Scheduling）</li>
          <li>加权最小连接调度（Weighted Least-Connection Scheduling）</li>
          <li>基于局部性的最少链接（Locality-Based Least Connections Scheduling）</li>
          <li>带复制的基于局部性最少链接（Locality-Based Least Connections with Replication Scheduling）</li>
          <li>目标地址散列调度（Destination Hashing Scheduling）</li>
          <li>源地址散列调度（Source Hashing Scheduling）</li>
        </ul>
      <p>下面，我们先介绍这八种连接调度算法的工作原理和算法流程，会在以后的文章中描述怎么用它们。</p>
      <p><a name="N10072"><span class="smalltitle">2.1. 轮叫调度</span></a></p>
      
      <p>轮叫调度（Round Robin Scheduling）算法就是以轮叫的方式依次将请求调度不同的服务器，即每次调度执行i = (i + 1) mod n，并选出第i台服务器。算法的优点是其简洁性，它无需记录当前所有连接的状态，所以它是一种无状态调度。</p>
      <p>在系统实现时，我们引入了一个额外条件，当服务器的权值为零时，表示该服务器不可用而不被调度。这样做的目的是将服务器切出服务（如屏蔽服务器故障和系统维护），同时与其他加权算法保持一致。所以，算法要作相应的改动，它的算法流程如下：</p>
      <br><a name="N10080"><b>轮叫调度算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, …, Sn-1}，一个指示变量i表示上一次选择的
服务器，W(Si)表示服务器Si的权值。变量i被初始化为n-1，其中n &gt; 0。
j = i;
do {
	j = (j + 1) mod n;
	if (W(Sj) &gt; 0) {
		i = j;
		return Si;
	}
} while (j != i);
return NULL;
</pre></td></tr></tbody></table><br> 
      <p>轮叫调度算法假设所有服务器处理性能均相同，不管服务器的当前连接数和响应速度。该算法相对简单，不适用于服务器组中处理性能不一的情况，而且当请求服务时间变化比较大时，轮叫调度算法容易导致服务器间的负载不平衡。</p>
      <p>虽然Round-Robin DNS方法也是以轮叫调度的方式将一个域名解析到多个IP地址，但轮叫DNS方法的调度粒度是基于每个域名服务器的，域名服务器对域名解析的缓存会妨碍轮叫解析域名生效，这会导致服务器间负载的严重不平衡。这里，IPVS轮叫调度算法的粒度是基于每个连接的，同一用户的不同连接都会被调度到不同的服务器上，所以这种细粒度的轮叫调度要比DNS的轮叫调度优越很多。</p>
      <p><a name="N10090"><span class="smalltitle">2.2. 加权轮叫调度</span></a></p>
      
      <p>加权轮叫调度（Weighted Round-Robin Scheduling）算法可以解决服务器间性能不一的情况，它用相应的权值表示服务器的处理性能，服务器的缺省权值为1。假设服务器A的权值为1，B的权值为2，则表示服务器B的处理性能是A的两倍。加权轮叫调度算法是按权值的高低和轮叫方式分配请求到各服务器。权值高的服务器先收到的连接，权值高的服务器比权值低的服务器处理更多的连接，相同权值的服务器处理相同数目的连接数。加权轮叫调度算法流程如下：</p>
      <br><a name="N1009B"><b>加权轮叫调度算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, …, Sn-1}，W(Si)表示服务器Si的权值，一个
指示变量i表示上一次选择的服务器，指示变量cw表示当前调度的权值，max(S)
表示集合S中所有服务器的最大权值，gcd(S)表示集合S中所有服务器权值的最大
公约数。变量i和cw最初都被初始化为零。
while (true) {
	if (i == 0) {
		cw = cw - gcd(S);
		if (cw &lt;= 0) {
		cw = max(S);
		if (cw == 0)
			return NULL;
		}
	} else i = (i + 1) mod n;
	if (W(Si) &gt;= cw)
		return Si;
}
</pre></td></tr></tbody></table><br> 
      <p>例如，有三个服务器A、B和C分别有权值4、3和2，则在一个调度周期内(mod sum(W(Si)))调度序列为AABABCABC。加权轮叫调度算法还是比较简单和高效。当请求的服务时间变化很大，单独的加权轮叫调度算法依然会导致服务器间的负载不平衡。</p>
      <p>从上面的算法流程中，我们可以看出当服务器的权值为零时，该服务器不被被调度；当所有服务器的权值为零，即对于任意i有W(Si)=0，则没有任何服务器可用，算法返回NULL，所有的新连接都会被丢掉。加权轮叫调度也无需记录当前所有连接的状态，所以它也是一种无状态调度。</p>
      <p><a name="N100AB"><span class="smalltitle">2.3. 最小连接调度</span></a></p>
      
      <p>最小连接调度（Least-Connection Scheduling）算法是把新的连接请求分配到当前连接数最小的服务器。最小连接调度是一种动态调度算法，它通过服务器当前所活跃的连接数来估计服务器的负载情况。调度器需要记录各个服务器已建立连接的数目，当一个请求被调度到某台服务器，其连接数加1；当连接中止或超时，其连接数减一。</p>
      <p>在系统实现时，我们也引入当服务器的权值为零时，表示该服务器不可用而不被调度，它的算法流程如下：</p>
      <br><a name="N100B9"><b>最小连接调度算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, ..., Sn-1}，W(Si)表示服务器Si的权值，
C(Si)表示服务器Si的当前连接数。
for (m = 0; m &lt; n; m++) {
	if (W(Sm) &gt; 0) {
		for (i = m+1; i &lt; n; i++) {
			if (W(Si) &lt;= 0)
				continue;
			if (C(Si) &lt; C(Sm))
				m = i;
		}
		return Sm;
	}
}
return NULL;
</pre></td></tr></tbody></table><br> 
      <p>当各个服务器有相同的处理性能时，最小连接调度算法能把负载变化大的请求分布平滑到各个服务器上，所有处理时间比较长的请求不可能被发送到同一台服务器上。但是，当各个服务器的处理能力不同时，该算法并不理想，因为TCP连接处理请求后会进入TIME_WAIT状态，TCP的TIME_WAIT一般为2分钟，此时连接还占用服务器的资源，所以会出现这样情形，性能高的服务器已处理所收到的连接，连接处于TIME_WAIT状态，而性能低的服务器已经忙于处理所收到的连接，还不断地收到新的连接请求。</p>
      <p><a name="N100C6"><span class="smalltitle">2.4. 加权最小连接调度</span></a></p>
      
      <p>加权最小连接调度（Weighted Least-Connection Scheduling）算法是最小连接调度的超集，各个服务器用相应的权值表示其处理性能。服务器的缺省权值为1，系统管理员可以动态地设置服务器的权值。加权最小连接调度在调度新连接时尽可能使服务器的已建立连接数和其权值成比例。加权最小连接调度的算法流程如下：</p>
      <br><a name="N100D1"><b>加权最小连接调度的算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, ..., Sn-1}，W(Si)表示服务器Si的权值，
C(Si)表示服务器Si的当前连接数。所有服务器当前连接数的总和为
CSUM = ΣC(Si)  (i=0, 1, .. , n-1)。当前的新连接请求会被发送服务器Sm，
当且仅当服务器Sm满足以下条件
  (C(Sm) / CSUM)/ W(Sm) = min { (C(Si) / CSUM) / W(Si)}  (i=0, 1, . , n-1)
  其中W(Si)不为零
因为CSUM在这一轮查找中是个常数，所以判断条件可以简化为
  C(Sm) / W(Sm) = min { C(Si) / W(Si)}  (i=0, 1, . , n-1)
  其中W(Si)不为零
因为除法所需的CPU周期比乘法多，且在Linux内核中不允许浮点除法，服务器的
权值都大于零，所以判断条件C(Sm) / W(Sm) &gt; C(Si) / W(Si) 可以进一步优化
为C(Sm)*W(Si) &gt; C(Si)* W(Sm)。同时保证服务器的权值为零时，服务器不被调
度。所以，算法只要执行以下流程。
for (m = 0; m &lt; n; m++) {
	if (W(Sm) &gt; 0) {
		for (i = m+1; i &lt; n; i++) {
			if (C(Sm)*W(Si) &gt; C(Si)*W(Sm))
				m = i;
		}
		return Sm;
	}
}
return NULL;
</pre></td></tr></tbody></table><br> 
      <p><a name="N100DB"><span class="smalltitle">2.5. 基于局部性的最少链接调度</span></a></p>
      
      <p>基于局部性的最少链接调度（Locality-Based Least Connections Scheduling，以下简称为LBLC）算法是针对请求报文的目标IP地址的负载均衡调度，目前主要用于Cache集群系统，因为在Cache集群中客户请求报文的目标IP地址是变化的。这里假设任何后端服务器都可以处理任一请求，算法的设计目标是在服务器的负载基本平衡情况下，将相同目标IP地址的请求调度到同一台服务器，来提高各台服务器的访问局部性和主存Cache命中率，从而整个集群系统的处理能力。</p>
      <p>LBLC调度算法先根据请求的目标IP地址找出该目标IP地址最近使用的服务器，若该服务器是可用的且没有超载，将请求发送到该服务器；若服务器不存在，或者该服务器超载且有服务器处于其一半的工作负载，则用“最少链接”的原则选出一个可用的服务器，将请求发送到该服务器。该算法的详细流程如下：</p>
      <br><a name="N100E9"><b>LBLC调度算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, ..., Sn-1}，W(Si)表示服务器Si的权值，
C(Si)表示服务器Si的当前连接数。ServerNode[dest_ip]是一个关联变量，表示
目标IP地址所对应的服务器结点，一般来说它是通过Hash表实现的。WLC(S)表示
在集合S中的加权最小连接服务器，即前面的加权最小连接调度。Now为当前系统
时间。
if (ServerNode[dest_ip] is NULL) then {
	n = WLC(S);
	if (n is NULL) then return NULL;
	ServerNode[dest_ip].server = n;
} else {
	n = ServerNode[dest_ip].server;
	if ((n is dead) OR
	    (C(n) &gt; W(n) AND
	     there is a node m with C(m) &lt; W(m)/2))) then {
		n = WLC(S);
		if (n is NULL) then return NULL;
		ServerNode[dest_ip].server = n;
	}
}
ServerNode[dest_ip].lastuse = Now;
return n;
</pre></td></tr></tbody></table><br> 
      <p>此外，对关联变量ServerNode[dest_ip]要进行周期性的垃圾回收（Garbage Collection），将过期的目标IP地址到服务器关联项进行回收。过期的关联项是指哪些当前时间（实现时采用系统时钟节拍数jiffies）减去最近使用时间超过设定过期时间的关联项，系统缺省的设定过期时间为24小时。</p>
      <p><a name="N100F6"><span class="smalltitle">2.6. 带复制的基于局部性最少链接调度</span></a></p>
      
      <p>带复制的基于局部性最少链接调度（Locality-Based Least Connections with Replication Scheduling，以下简称为LBLCR）算法也是针对目标IP地址的负载均衡，目前主要用于Cache集群系统。它与LBLC算法的不同之处是它要维护从一个目标IP地址到一组服务器的映射，而LBLC算法维护从一个目标IP地址到一台服务器的映射。对于一个“热门”站点的服务请求，一台Cache服务器可能会忙不过来处理这些请求。这时，LBLC调度算法会从所有的Cache服务器中按“最小连接”原则选出一台Cache服务器，映射该“热门”站点到这台Cache服务器，很快这台Cache服务器也会超载，就会重复上述过程选出新的Cache服务器。这样，可能会导致该“热门”站点的映像会出现在所有的Cache服务器上，降低了Cache服务器的使用效率。LBLCR调度算法将“热门”站点映射到一组Cache服务器（服务器集合），当该“热门”站点的请求负载增加时，会增加集合里的Cache服务器，来处理不断增长的负载；当该“热门”站点的请求负载降低时，会减少集合里的Cache服务器数目。这样，该“热门”站点的映像不太可能出现在所有的Cache服务器上，从而提供Cache集群系统的使用效率。</p>
      <p>LBLCR算法先根据请求的目标IP地址找出该目标IP地址对应的服务器组；按“最小连接”原则从该服务器组中选出一台服务器，若服务器没有超载，将请求发送到该服务器；若服务器超载；则按“最小连接”原则从整个集群中选出一台服务器，将该服务器加入到服务器组中，将请求发送到该服务器。同时，当该服务器组有一段时间没有被修改，将最忙的服务器从服务器组中删除，以降低复制的程度。LBLCR调度算法的流程如下：</p>
      <br><a name="N10104"><b>LBLCR调度算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, ..., Sn-1}，W(Si)表示服务器Si的权值，
C(Si)表示服务器Si的当前连接数。ServerSet[dest_ip]是一个关联变量，表示
目标IP地址所对应的服务器集合，一般来说它是通过Hash表实现的。WLC(S)表示
在集合S中的加权最小连接服务器，即前面的加权最小连接调度；WGC(S)表示在
集合S中的加权最大连接服务器。Now为当前系统时间，lastmod表示集合的最近
修改时间，T为对集合进行调整的设定时间。
if (ServerSet[dest_ip] is NULL) then {
	n = WLC(S);
	if (n is NULL) then return NULL;
	add n into ServerSet[dest_ip];
} else {
	n = WLC(ServerSet[dest_ip]);
	if ((n is NULL) OR
	    (n is dead) OR
	    (C(n) &gt; W(n) AND
	     there is a node m with C(m) &lt; W(m)/2))) then {
		n = WLC(S);
		if (n is NULL) then return NULL;
		add n into ServerSet[dest_ip];
	} else
	if (|ServerSet[dest_ip]| &gt; 1 AND
	    Now - ServerSet[dest_ip].lastmod &gt; T) then {
		m = WGC(ServerSet[dest_ip]);
		remove m from ServerSet[dest_ip];
	}
}
ServerSet[dest_ip].lastuse = Now;
if (ServerSet[dest_ip] changed) then
	ServerSet[dest_ip].lastmod = Now;
return n;
</pre></td></tr></tbody></table><br> 
      <p>此外，对关联变量ServerSet[dest_ip]也要进行周期性的垃圾回收（Garbage Collection），将过期的目标IP地址到服务器关联项进行回收。过期的关联项是指哪些当前时间（实现时采用系统时钟节拍数jiffies）减去最近使用时间（lastuse）超过设定过期时间的关联项，系统缺省的设定过期时间为24小时。</p>
      <p><a name="N10111"><span class="smalltitle">2.7. 目标地址散列调度</span></a></p>
      
      <p>目标地址散列调度（Destination Hashing Scheduling）算法也是针对目标IP地址的负载均衡，但它是一种静态映射算法，通过一个散列（Hash）函数将一个目标IP地址映射到一台服务器。</p>
      <p>目标地址散列调度算法先根据请求的目标IP地址，作为散列键（Hash Key）从静态分配的散列表找出对应的服务器，若该服务器是可用的且未超载，将请求发送到该服务器，否则返回空。该算法的流程如下：</p>
      <br><a name="N1011F"><b>目标地址散列调度算法流程</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">假设有一组服务器S = {S0, S1, ..., Sn-1}，W(Si)表示服务器Si的权值，
C(Si)表示服务器Si的当前连接数。ServerNode[]是一个有256个桶（Bucket）的
Hash表，一般来说服务器的数目会运小于256，当然表的大小也是可以调整的。
算法的初始化是将所有服务器顺序、循环地放置到ServerNode表中。若服务器的
连接数目大于2倍的权值，则表示服务器已超载。
n = ServerNode[hashkey(dest_ip)];
if ((n is dead) OR
	(W(n) == 0) OR
    (C(n) &gt; 2*W(n))) then
	return NULL;
return n;
</pre></td></tr></tbody></table><br> 
      <p>在实现时，我们采用素数乘法Hash函数，通过乘以素数使得散列键值尽可能地达到较均匀的分布。所采用的素数乘法Hash函数如下：</p>
      <br><a name="N1012C"><b>素数乘法Hash函数</b></a><br>
 
      <table width="100%" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="code-outline"><pre class="displaycode">static inline unsigned hashkey(unsigned int dest_ip)
{
    return (dest_ip* 2654435761UL) &amp; HASH_TAB_MASK;
}
其中，2654435761UL是2到2^32 (4294967296)间接近于黄金分割的素数，
  (sqrt(5) - 1) / 2 =  0.618033989
  2654435761 / 4294967296 = 0.618033987
</pre></td></tr></tbody></table><br> 
      <p><a name="N10136"><span class="smalltitle">2.8. 源地址散列调度</span></a></p>
      
      <p>源地址散列调度（Source Hashing Scheduling）算法正好与目标地址散列调度算法相反，它根据请求的源IP地址，作为散列键（Hash Key）从静态分配的散列表找出对应的服务器，若该服务器是可用的且未超载，将请求发送到该服务器，否则返回空。它采用的散列函数与目标地址散列调度算法的相同。它的算法流程与目标地址散列调度算法的基本相似，除了将请求的目标IP地址换成请求的源IP地址，所以这里不一一叙述。</p>
      <p>在实际应用中，源地址散列调度和目标地址散列调度可以结合使用在防火墙集群中，它们可以保证整个系统的唯一出入口。</p>
      <div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><p><a name="3"><span class="atitle">动态反馈负载均衡算法</span></a></p>
      <p>动态反馈负载均衡算法考虑服务器的实时负载和响应情况，不断调整服务器间处理请求的比例，来避免有些服务器超载时依然收到大量请求，从而提高整个系统的吞吐率。图1显示了该算法的工作环境，在负载调度器上运行Monitor Daemon进程，Monitor Daemon来监视和收集各个服务器的负载信息。Monitor Daemon可根据多个负载信息算出一个综合负载值。Monitor Daemon将各个服务器的综合负载值和当前权值算出一组新的权值，若新权值和当前权值的差值大于设定的阀值，Monitor Daemon将该服务器的权值设置到内核中的IPVS调度中，而在内核中连接调度一般采用加权轮叫调度算法或者加权最小连接调度算法。</p>
      
        <br>
        <img alt="动态反馈负载均衡算法的工作环境" height="460" src="./Linux服务器集群系统(四)_files/load-manager.jpg" width="502">
      <br>
      <p><strong>图1：动态反馈负载均衡算法的工作环境</strong>
      </p>
      <p><a name="N10162"><span class="smalltitle">3.1. 连接调度</span></a></p>
      
      <p>当客户通过TCP连接访问网络访问时，服务所需的时间和所要消耗的计算资源是千差万别的，它依赖于很多因素。例如，它依赖于请求的服务类型、当前网络带宽的情况、以及当前服务器资源利用的情况。一些负载比较重的请求需要进行计算密集的查询、数据库访问、很长响应数据流；而负载比较轻的请求往往只需要读一个HTML页面或者进行很简单的计算。</p>
      <p>请求处理时间的千差万别可能会导致服务器利用的倾斜（Skew），即服务器间的负载不平衡。例如，有一个WEB页面有A、B、C和D文件，其中D是大图像文件，浏览器需要建立四个连接来取这些文件。当多个用户通过浏览器同时访问该页面时，最极端的情况是所有D文件的请求被发到同一台服务器。所以说，有可能存在这样情况，有些服务器已经超负荷运行，而其他服务器基本是闲置着。同时，有些服务器已经忙不过来，有很长的请求队列，还不断地收到新的请求。反过来说，这会导致客户长时间的等待，觉得系统的服务质量差。</p>
      <p>3.1.1. 简单连接调度</p>
      <p>简单连接调度可能会使得服务器倾斜的发生。在上面的例子中，若采用轮叫调度算法，且集群中正好有四台服务器，必有一台服务器总是收到D文件的请求。这种调度策略会导致整个系统资源的低利用率，因为有些资源被用尽导致客户的长时间等待，而其他资源空闲着。</p>
      <p>3.1.2. 实际TCP/IP流量的特征</p>
      <p>文献[1]说明网络流量是呈波浪型发生的，在一段较长时间的小流量后，会有一段大流量的访问，然后是小流量，这样跟波浪一样周期性地发生。文献[2,3,4,5]揭示在WAN和LAN上网络流量存在自相似的特征，在WEB访问流也存在自相似性。这就需要一个动态反馈机制，利用服务器组的状态来应对访问流的自相似性。</p>
      <p><a name="N1017C"><span class="smalltitle">3.2. 动态反馈负载均衡机制</span></a></p>
      
      <p>TCP/IP流量的特征通俗地说是有许多短事务和一些长事务组成，而长事务的工作量在整个工作量占有较高的比例。所以，我们要设计一种负载均衡算法，来避免长事务的请求总被分配到一些机器上，而是尽可能将带有毛刺（Burst）的分布分割成相对较均匀的分布。</p>
      <p>我们提出基于动态反馈负载均衡机制，来控制新连接的分配，从而控制各个服务器的负载。例如，在IPVS调度器的内核中使用加权轮叫调度（Weighted Round-Robin Scheduling）算法来调度新的请求连接；在负载调度器的用户空间中运行Monitor Daemon。Monitor Daemon定时地监视和收集各个服务器的负载信息，根据多个负载信息算出一个综合负载值。Monitor Daemon将各个服务器的综合负载值和当前权值算出一组新的权值。当综合负载值表示服务器比较忙时，新算出的权值会比其当前权值要小，这样新分配到该服务器的请求数就会少一些。当综合负载值表示服务器处于低利用率时，新算出的权值会比其当前权值要大，来增加新分配到该服务器的请求数。若新权值和当前权值的差值大于设定的阀值，Monitor Daemon将该服务器的权值设置到内核中的IPVS调度中。过了一定的时间间隔（如2秒钟），Monitor Daemon再查询各个服务器的情况，并相应调整服务器的权值；这样周期性地进行。可以说，这是一个负反馈机制，使得服务器保持较好的利用率。</p>
      <p>在加权轮叫调度算法中，当服务器的权值为零，已建立的连接会继续得到该服务器的服务，而新的连接不会分配到该服务器。系统管理员可以将一台服务器的权值设置为零，使得该服务器安静下来，当已有的连接都结束后，他可以将该服务器切出，对其进行维护。维护工作对系统都是不可少的，比如硬件升级和软件更新等，零权值使得服务器安静的功能很主要。所以，在动态反馈负载均衡机制中我们要保证该功能，当服务器的权值为零时，我们不对服务器的权值进行调整。</p>
      <p><a name="N1018D"><span class="smalltitle">3.3. 综合负载</span></a></p>
      
      <p>在计算综合负载时，我们主要使用两大类负载信息：输入指标和服务器指标。输入指标是在调度器上收集到的，而服务器指标是在服务器上的各种负载信息。我们用综合负载来反映服务器当前的比较确切负载情况，对于不同的应用，会有不同的负载情况，这里我们引入各个负载信息的系数，来表示各个负载信息在综合负载中轻重。系统管理员根据不同应用的需求，调整各个负载信息的系数。另外，系统管理员设置收集负载信息的时间间隔。</p>
      <p>输入指标主要是在单位时间内服务器收到新连接数与平均连接数的比例，它是在调度器上收集到的，所以这个指标是对服务器负载情况的一个估计值。在调度器上有各个服务器收到连接数的计数器，对于服务器Si，可以得到分别在时间T1和T2时的计数器值Ci1和Ci2，计算出在时间间隔T2-T1内服务器Si收到新连接数Ni = Ci2 - Ci1。这样，得到一组服务器在时间间隔T2-T1内服务器Si收到新连接数{Ni}，服务器Si的输入指标INPUTi为其新连接数与n台服务器收到平均连接数的比值，其公式为</p>
      
        <br>
        <img alt="" height="58" src="./Linux服务器集群系统(四)_files/input-formula.gif" width="124">
      <br>
      <p>服务器指标主要记录服务器各种负载信息，如服务器当前CPU负载LOADi、服务器当前磁盘使用情况Di、当前内存利用情况Mi和当前进程数目Pi。有两种方法可以获得这些信息；一是在所有的服务器上运行着SNMP（Simple Network Management Protocol）服务进程，而在调度器上的Monitor Daemon通过SNMP向各个服务器查询获得这些信息；二是在服务器上实现和运行收集信息的Agent，由Agent定时地向Monitor Daemon报告负载信息。若服务器在设定的时间间隔内没有响应，Monitor Daemon认为服务器是不可达的，将服务器在调度器中的权值设置为零，不会有新的连接再被分配到该服务器；若在下一次服务器有响应，再对服务器的权值进行调整。再对这些数据进行处理，使其落在[0, ∞)的区间内，1表示负载正好，大于1表示服务器超载，小于1表示服务器处于低负载状态。获得调整后的数据有DISKi、MEMORYi和PROCESSi。</p>
      <p>另一个重要的服务器指标是服务器所提供服务的响应时间，它能比较好地反映服务器上请求等待队列的长度和请求的处理时间。调度器上的Monitor Daemon作为客户访问服务器所提供的服务，测得其响应时间。例如，测试从WEB服务器取一个HTML页面的响应延时，Monitor Daemon只要发送一个“GET /”请求到每个服务器，然后记录响应时间。若服务器在设定的时间间隔内没有响应，Monitor Daemon认为服务器是不可达的，将服务器在调度器中的权值设置为零。同样，我们对响应时间进行如上调整，得到RESPONSEi。</p>
      <p>这里，我们引入一组可以动态调整的系数Ri来表示各个负载参数的重要程度，其中ΣRi = 1。综合负载可以通过以下公式计算出：</p>
      
        <br>
        <img alt="" height="35" src="./Linux服务器集群系统(四)_files/agload-formula.gif" width="429">
      <br>
      <p>例如，在WEB服务器集群中，我们采用以下系数{0.1, 0.3, 0.1, 0.1, 0.1, 0.3}，认为服务器的CPU负载和请求响应时间较其他参数重要一些。若当前的系数Ri不能很好地反映应用的负载，系统管理员可以对系数不断地修正，直到找到贴近当前应用的一组系数。</p>
      <p>另外，关于查询时间间隔的设置，虽然很短的间隔可以更确切地反映各个服务器的负载，但是很频繁地查询（如1秒钟几次）会给调度器和服务器带来一定的负载，如频繁执行的Monitor Daemon在调度器会有一定的开销，同样频繁地查询服务器指标会服务器带来一定的开销。所以，这里要有个折衷（Tradeoff），我们一般建议将时间间隔设置在5到20秒之间。</p>
      <p><a name="N101C8"><span class="smalltitle">3.4. 权值计算</span></a></p>
      
      <p>当服务器投入集群系统中使用时，系统管理员对服务器都设定一个初始权值DEFAULT_WEIGHTi，在内核的IPVS调度中也先使用这个权值。然后，随着服务器负载的变化，对权值进行调整。为了避免权值变成一个很大的值，我们对权值的范围作一个限制[DEFAULT_WEIGHTi, SCALE*DEFAULT_WEIGHTi]，SCALE是可以调整的，它的缺省值为10。</p>
      <p>Monitor Daemon周期性地运行，若DEFAULT_WEIGHTi不为零，则查询该服务器的各负载参数，并计算出综合负载值AGGREGATE_LOADi。我们引入以下权值计算公式，根据服务器的综合负载值调整其权值。</p>
      
        <br>
        <img alt="" height="46" src="./Linux服务器集群系统(四)_files/weight-formula1.gif" width="528">
      <br>
      <p>在公式中，0.95是我们想要达到的系统利用率，A是一个可调整的系数（缺省值为5）。当综合负载值为0.95时，服务器权值不变；当综合负载值大于0.95时，权值变小；当综合负载值小于0.95时，权值变大。若新权值大于SCALE*DEFAULT_WEIGHTi，我们将新权值设为SCALE*DEFAULT_WEIGHTi。若新权值与当前权值的差异超过设定的阀值，则将新权值设置到内核中的IPVS调度参数中，否则避免打断IPVS调度的开销。我们可以看出这是一个负反馈公式，会使得权值调整到一个稳定点，如系统达到理想利用率时，权值是不变的。</p>
      <p>在实际使用中，若发现所有服务器的权值都小于他们的DEFAULT_WEIGHT，则说明整个服务器集群处于超载状态，这时需要加入新的服务器结点到集群中来处理部分负载；反之，若所有服务器的权值都接近于SCALE*DEFAULT_WEIGHT，则说明当前系统的负载都比较轻。</p>
      <p><a name="N101EB"><span class="smalltitle">3.5. 一个实现例子</span></a></p>
      
      <p>我们在RedHat集群管理工具Piranha[6]中实现了一个简单的动态反馈负载均衡算法。在综合负载上，它只考虑服务器的CPU负载（Load Average），使用以下公式进行权值调整：</p>
      
        <br>
        <img alt="" height="47" src="./Linux服务器集群系统(四)_files/weight-formula2.gif" width="496">
      <br>
      <p>服务器权值调整区间为[DEFAULT_WEIGHTi, 10*DEFAULT_WEIGHTi]，A为DEFAULT_WEIGHTi /2，而权值调整的阀值为DEFAULT_WEIGHTi /4。1是所想要达到的系统利用率。Piranha每隔20秒查询各台服务器的CPU负载，进行权值计算和调整。</p>
      <div class="ibm-alternate-rule"><hr></div><p class="ibm-ind-link ibm-back-to-top"><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><p><a name="4"><span class="atitle">小结</span></a></p>
      
      <p>本文主要讲述了IP虚拟服务器在内核中实现的八种连接调度算法：
        </p><ul>
          <li>轮叫调度（Round-Robin Scheduling）</li>
          <li>加权轮叫调度（Weighted Round-Robin Scheduling）</li>
          <li>最小连接调度（Least-Connection Scheduling）</li>
          <li>加权最小连接调度（Weighted Least-Connection Scheduling）</li>
          <li>基于局部性的最少链接（Locality-Based Least Connections Scheduling）</li>
          <li>带复制的基于局部性最少链接（Locality-Based Least Connections with Replication Scheduling）</li>
          <li>目标地址散列调度（Destination Hashing Scheduling）</li>
          <li>源地址散列调度（Source Hashing Scheduling）</li>
        </ul>
      <p>因为请求的服务时间差异较大，内核中的连接调度算法容易使得服务器运行出现倾斜。为此，给出了一个动态反馈负载均衡算法，结合内核中的加权连接调度算法，根据动态反馈回来的负载信息来调整服务器的权值，来调整服务器间处理请求数的比例，从而避免服务器间的负载不平衡。动态反馈负载算法可以较好地避免服务器的倾斜，提高系统的资源使用效率，从而提高系统的吞吐率。</p>
    <!-- CMA ID: 21562 --> <!-- Site ID: 10 --> <!-- XSLT stylesheet used to transform this file:  dw-article-6.0-beta.xsl -->
<br>
<p><a name="resources"><span class="atitle">参考资料 </span></a></p>
      <ol>
        <li>William Stalling, Viewpoint: Self-similarity upsets data traffic assumptions, IEEE Spectrum, January 1997.</li>
        <li>Kihong Park, Gitae Kim, Mark Crovella, "On the Effect of Traffic Self-similarity on Network Performance", In Proceedings of the 1997 SPIE International Conference on Performance and Control of Network Systems, 1997.</li>
        <li>Nicolas D. Georganas, Self-Similar ("Fractal") Traffic in ATM Networks, In Proceedings of the 2nd International Workshop on Advanced Teleservices and High-Speed Communications Architectures (IWACA'94), pages 1-7, Heidelberg, Germany, September 1994.</li>
        <li>Mark Crovella and Azer Besavros, Explaining World Wide Web Traffic Self-Similarity. Technical report, Boston University, October 1995, TR-95-015.</li>
        <li>Bruce A. Mah. An Empirical Model of HTTP Network Traffic. In Proceedings of INFOCOM 97, Kobe, Japan, April 1997.</li>
        <li>Red Hat High Availability Server Project,
          <a href="http://ha.redhat.com/">http://ha.redhat.com/</a>
        </li>
        <li>The Linux Virtual Server Project,
          <a href="http://www.linuxvirtualserver.org/">http://www.LinuxVirtualServer.org/</a>
        </li>
      </ol>
<p><a name="author"><span class="atitle">关于作者</span></a></p><div class="ibm-container ibm-portrait-module ibm-alternate-two"><div class="ibm-container-body"><p><a name="author1"> </a>章文嵩博士，开放源码及Linux内核的开发者，著名的Linux集群项目－－LVS(Linux Virtual
Server)的创始人和主要开发人员。他目前工作于国家并行与分布式处理重点实验室，主要从事集群技术、操作系统、对象存储与数据库的研究。他一直在自由软件的开发上花费大量时间，并以此为乐。</p></div></div>
<!-- MAIN_COLUMN_CONTENT_END -->

  <!-- INLINE_COMMENTS_START -->
  <p class="ibm-no-print"><span class="atitle"><a name="icomments">建议</a></span></p>
  <div id="dw-icomments-container" class="ibm-no-print">
    <div class="ibm-alternate-rule"><hr></div>
    <div class="ibm-alternate-rule"><hr></div>
    <!-- Comment_Script -->
    
    <a id="comments" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/comments"></a>
    <script language="JavaScript" type="text/javascript">
      // <![CDATA[
dwc = {};
dwc.cmts = '条评论';
dwc.signIn = '登录';
dwc.addCmts = '添加评论';
dwc.addCmt = '添加评论';
dwc.viewOrAddCmts = '查看或添加评论';
dwc.reportInapprCont = '举报不良信息';
dwc.reportInapprContLink = 'http://www.ibm.com/developerworks/forums/forum.jspa?forumID=1834';
dwc.postingCmt = '正在发布评论……';
dwc.noCmt = '快来添加第一条评论';
dwc.netwkErr = '在检索评论时出错，请稍后刷新。';
dwc.addACmt = '添加评论';
dwc.instructCmt = '标有星号（<span class="ibm-required">*</span>）的是必填项目。';
dwc.cmt = '评论：';
dwc.btnPost = '发布';
dwc.btnPostAnon = '匿名发布';
dwc.btnClrCmt = '清除评论';
dwc.btnCancel = '取消';
dwc.showRecent = '显示最新的 {1} 条评论'; // {1} is the count to be substituted
dwc.showNext = '显示后 {1} 条评论'; // {1} is the count to be substituted
dwc.showAllCmts = '显示所有评论';
dwc.enterCmt = '请输入评论内容。';
dwc.loginErr = '暂时无法验证您的登录状态，请稍后再试。';
dwc.postErr = '暂时无法发布您的评论，请稍后再试。';
dwc.postBy = '由 <b>{1}</b>  于 {2} '; // {1} is the author to be substituted; {2} is the date
dwc.siteId = 10;
dwc.lang = 'zh_CN';
// ]]>
    </script>
    <script language="JavaScript" src="./Linux服务器集群系统(四)_files/insertcomment.js" type="text/javascript">//</script>
    <div id="threadShow"><div id="cmtTog" style=""><p><span id="numCmts">0</span>&nbsp;条评论 <span class="dw-bar">|</span> <a class="loginLk" style="display: none; " href="https://www.ibm.com/developerworks/dwwi/DWAuthRouter?m=loginpage&lang=zh_CN&d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Flinux%2Fcluster%2Flvs%2Fpart4%2F%23icomments">登录</a><a id="addCmtLk" class="dw-icomment-link">添加评论</a><a class="dw-icomment-report" href="http://www.ibm.com/developerworks/forums/forum.jspa?forumID=1834">举报不良信息</a></p><div class="ibm-alternate-rule"><hr></div><div id="commentForm" style="display: none; "><div class="ibm-container"><h2>添加评论</h2><div class="ibm-container-body"><p>标有星号（<span class="ibm-required">*</span>）的是必填项目。</p><span id="infoCmt"></span><div class="ibm-rule"><hr></div><form method="post" action="" class="ibm-column-form" enctype="multipart/form-data" focus="name" name="form"><p><label for="newCmt">评论：<span class="ibm-required">*</span></label><br><textarea name="newCmt" id="newCmt" cols="120" rows="4"></textarea></p><div class="ibm-alternate-rule"><hr></div><p class="ibm-buttons-row"><input value="发布" type="button" name="postCmt" class="ibm-btn-arrow-sec" id="postCmt"><span class="ibm-sep">&nbsp;</span><input value="清除评论" type="button" name="clearCmt" class="ibm-btn-cancel-sec" id="clearCmt"><span class="ibm-sep">&nbsp;</span><input value="取消" type="button" name="cancelCmt" class="ibm-btn-cancel-sec" id="cancelCmt"></p></form></div></div></div><div id="cmtSect"><div class="comment"><div class="dw-icomment-container"><table class="dw-icomment-body" cellpadding="0" cellspacing="0" width="100%"><tbody><tr><td><p>快来添加第一条评论</p></td></tr></tbody></table></div></div></div><div id="paging"><p><a id="lastCmts" class="dw-icomment-link" style="display: none; ">显示最新的 5 条评论</a><span id="cmtDivider" style="display: none; "> <span class="dw-bar">|</span> </span><a id="nextCmts" class="dw-icomment-link" style="display: none; ">显示后 5 条评论</a><span id="cmtDivider2" style="display: none; "> <span class="dw-bar">|</span> </span><a id="viewAllCmts" class="dw-icomment-link" style="display: none; ">显示所有评论</a></p></div><p><a class="loginLk" style="display: none; " href="https://www.ibm.com/developerworks/dwwi/DWAuthRouter?m=loginpage&lang=zh_CN&d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fcn%2Flinux%2Fcluster%2Flvs%2Fpart4%2F%23icomments">登录</a><a id="addCmtLk2" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#icomments">添加评论</a></p><div class="ibm-alternate-rule"><hr></div><div class="ibm-alternate-rule"><hr></div></div></div>
    <script language="JavaScript" type="text/javascript">
      // <![CDATA[
jQuery('threadShow').insertComment('95%',5,'nCmts','icomments');
// ]]>
    </script>
  </div>
  <!-- INLINE_COMMENTS_END -->
  

  <p class="ibm-ind-link ibm-back-to-top"><a class="ibm-anchor-up-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#ibm-pcon">回页首</a></p>
  <p><a href="http://www.ibm.com/developerworks/cn/ibm/trademarks/">商标</a> &nbsp;|&nbsp; <a href="http://www.ibm.com/developerworks/cn/mydw_terms/">My developerWorks 使用条款与条件</a></p>

<!-- Overlays -->
<!-- lk - pull in overlays from ww when required on cn -->
  </div>
<!-- MAIN_COLUMN_CONTAINER_END -->

<!-- Rating_Meta_BEGIN -->
<!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=10</div><div class="metavalue">Zone=Linux</div><div class="metavalue">ArticleID=21562</div><div class="metavalue">ArticleTitle=Linux服务器集群系统(四)</div><div class="metavalue">publish-date=05202002</div><div class="metavalue">author1-email=wensong@linux-vs.org</div><div class="metavalue">author1-email-cc=wensong@linux-vs.org</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace('<', '%3C')+'</div>');</script><div class="metavalue">url=https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/</div><!--Rating_Meta_END-->
<!-- Rating_Meta_END -->

</div>
<!-- MAIN_COLUMN_END-->

<!-- RIGHT_COLUMN_BEGIN -->
<div id="ibm-content-sidebar">

<!-- RIGHT_COLUMN_CONTENT_BEGIN --> 
<div class="ibm-container"><h2>内容</h2><div class="ibm-container-body"><img alt="" height="1" width="1" src="./Linux服务器集群系统(四)_files/c(1).gif"><ul class="ibm-bullet-list"><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#1">前言</a></li><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#2">内核中的连接调度算法</a></li><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#3">动态反馈负载均衡算法</a></li><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#4">小结</a></li><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#resources">参考资料 </a></li><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#author">关于作者</a></li><li><a class="ibm-feature-link" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#icomments">建议</a></li></ul></div></div>

 

<!-- Tagging_Start -->
<div id="dw-tag-cloud-container" class="ibm-container dw-hidetag"><h2>标签</h2>
<div id="dw-tag-help"><a class="dwauthor" rel="#tagtip" id="dwtagtip"><img alt="Help" height="16" width="16" align="top" src="./Linux服务器集群系统(四)_files/help_icon.gif"></a></div>
<div id="tagtip" class="dwauthor-onload-state ibm-no-print" style="display: none; ">使用 <strong>搜索</strong> 文本框在 My developerWorks 中查找包含该标签的所有内容。<p>使用 <strong>滑动条</strong> 调节标签的数量。</p><p><strong>热门标签</strong> 显示了特定专区最受欢迎的标签（例如 Java technology，Linux，WebSphere）。</p><p><strong>我的标签&lt; /strong&gt; 显示了特定专区您标记的标签（例如 Java technology，Linux，WebSphere）。</strong></p></div><strong>
<div class="ibm-access">使用搜索文本框在 My developerWorks 中查找包含该标签的所有内容。<em>热门标签</em> 显示了特定专区最受欢迎的标签（例如 Java technology，Linux，WebSphere）。<em>我的标签</em> 显示了特定专区您标记的标签（例如 Java technology，Linux，WebSphere）。</div>
<div class="ibm-container-body">
<div class="dw-tag-search"><form action="https://www.ibm.com/developerworks/mydeveloperworks/bookmarks/html" method="get" id="actualtagform" onsubmit="popupform(this, &#39;join&#39;)">
<p><label for="tagfield"><strong>搜索所有标签</strong></label>
<input type="hidden" name="lang" value="zh">
<input id="tagfield" name="tag" type="text" maxlength="20" size="17">&nbsp;<input src="./Linux服务器集群系统(四)_files/short-btn.gif" type="image" class="ibm-btn-view" alt="submit search" title="提交搜索" value="Search"></p></form></div>
<div class="ibm-rule"><hr></div>
<div id="dw-tag-select">
<div id="dw-tag-select-popular"><p><strong>热门文章标签</strong>&nbsp;|&nbsp;<br><a id="a-my" href="javascript:;">我的文章标签</a><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#dw-tag-access" class="ibm-access">跳转到标签列表</a></p></div>
<div id="dw-tag-select-my" class="dw-hidetag"><p><a id="a-popular" href="javascript:;">热门文章标签</a>&nbsp;|&nbsp;<br><strong>我的文章标签</strong></p><a href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#dw-tag-access" class="ibm-access">跳转到标签列表</a></div>
<div id="dw-tag-cloud"></div>  
</div>   
</div>
</strong></div><strong>
<!-- Tagging_End -->

<!-- Dig_Deeper -->

<!-- High_Visibility_Offer -->

<!-- Special_Offers -->

<!-- RIGHT_COLUMN_CONTENT_END -->

</strong></div><strong>
<!-- RIGHT_COLUMN_END -->

<!-- CONTENT_BODY_END -->
</strong></div><strong>

</strong></div><strong>
<!-- CONTENT_END -->

 <!-- END_IBM-PCON -->
</strong></div><strong>

<!-- FOOTER_BEGIN -->
<div id="ibm-page-tools">
<!-- IBM page tools container -->
</div>
<div id="ibm-footer">
<ul>
<li class="ibm-first"><a href="http://www.ibm.com/ibm/cn/zh/">关于IBM</a></li>
<li><a href="http://www.ibm.com/privacy/cn/zh/">隐私条约</a></li>
<li><a href="http://www.ibm.com/contact/cn/zh/">联系IBM</a></li>
<li><a href="http://www.ibm.com/legal/cn/zh/">使用条款</a></li>
<li><a href="http://www.ibm.com/ibm/syndication/cn/zh/">IBM RSS 可定制阅读服务</a></li><li><a href="https://www.ibm.com/employment/cn/">求才启事</a></li></ul>
<div id="ibm-social-tools"><ul><li><a class="ibm-share-print" title="打印本页面" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" rel="print"></a></li><li><a class="ibm-share-email" title="用电子邮件发送本页面" href="https://www.ibm.com/developerworks/cn/linux/cluster/lvs/part4/#" rel="email"></a></li></ul></div></div>
<!-- FOOTER_END -->

 <!-- END_IBM-TOP -->
</strong><div id="ibm-overlay-top"></div></div><strong>
 
 <!-- SCRIPTS_INCLUDE_BEGIN -->
<!-- JQuery start -->
<script type="text/javascript" language="JavaScript" src="./Linux服务器集群系统(四)_files/jquery.dimensions-1.2.js"></script>
<script type="text/javascript" language="JavaScript" src="./Linux服务器集群系统(四)_files/jquery.hoverIntent.minified.js"></script>
<script type="text/javascript" language="JavaScript" src="./Linux服务器集群系统(四)_files/jquery.cluetip.js"></script>
<script type="text/javascript" language="JavaScript">
	jQuery.noConflict();     
	// Put all your code in your document ready area
	jQuery(document).ready(function(jQuery) {
	// Do jQuery stuff using jQuery 
	jQuery('a.dwauthor').cluetip({
		local: true,
		showTitle: false,
		positionBy: 'bottomTop',
		sticky: true,	
		mouseOutClose: true,
		closeText: '<img src="//dw1.s81c.com/developerworks/js/jquery/cluetip98/i/x.gif" alt="Close" />',
		arrows: false,
		dropShadow: true,
		cluetipClass: 'dwbasic'
		});   	
	});
 </script>
 <!-- JQuery end --><!-- BEGIN: Use this section to set page specific variables for the Unica Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=1&ibmAdoptPhase=667&ibmRole=710";</script>
<!--END --><!-- SCRIPTS_INCLUDE_END -->

<div id="ibm-metrics">
<script src="./Linux服务器集群系统(四)_files/stats.js" type="text/javascript">//</script>
</div>



</strong><div id="cluetip-waitimage" style="position: absolute; z-index: 95; display: none; "></div><div id="cluetip" style="display: none; position: absolute; z-index: 96; "><div style="z-index: 95; opacity: 0.1; top: 1px; left: 1px; position: absolute; background-color: rgb(0, 0, 0); "></div><div style="z-index: 94; opacity: 0.1; top: 2px; left: 2px; position: absolute; background-color: rgb(0, 0, 0); "></div><div style="z-index: 93; opacity: 0.1; top: 3px; left: 3px; position: absolute; background-color: rgb(0, 0, 0); "></div><div style="z-index: 92; opacity: 0.1; top: 4px; left: 4px; position: absolute; background-color: rgb(0, 0, 0); "></div><div style="z-index: 91; opacity: 0.1; top: 5px; left: 5px; position: absolute; background-color: rgb(0, 0, 0); "></div><div style="z-index: 90; opacity: 0.1; top: 6px; left: 6px; position: absolute; background-color: rgb(0, 0, 0); "></div><div id="cluetip-outer" style="position: relative; z-index: 97; "><h3 id="cluetip-title"></h3><div id="cluetip-inner"></div></div><div id="cluetip-extra"></div><div id="cluetip-arrows" class="cluetip-arrows" style="z-index: 97; "></div></div></body></html>